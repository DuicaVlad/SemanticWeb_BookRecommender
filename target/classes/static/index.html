<!DOCTYPE html>
<html>
<head>
    <title>Semantic Web System</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 1000px; margin: auto; }
        .section { background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ddd; }
        #mynetwork { width: 100%; height: 500px; border: 1px solid #333; background: #222; margin-top: 10px; }
        input, select { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box;}
        button { padding: 10px 15px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
        .book-item { background: white; padding: 10px; margin: 5px 0; border-left: 5px solid #007bff; cursor: pointer; }
        .book-item:hover { background: #eef; }
    </style>
</head>
<body>
    <h1>Book Recommendation System</h1>

    <div class="section">
        <h3>Visualize RDF Graph</h3>
        <input type="file" id="fileInput">
        <button onclick="uploadAndVisualize()">Upload & Visualize</button>
        <div id="mynetwork"></div>
    </div>

    <div class="section">
        <h3>Available Books</h3>
        <button onclick="loadBooks()">Refresh Book List</button>
        <div id="bookList"></div>
    </div>

    <div class="section">
        <h3>Add or Modify Book</h3>
        <div style="margin-bottom:10px"><label>ID (Required):</label> <input type="text" id="bId" placeholder="e.g. HarryPotter"></div>
        <div style="margin-bottom:10px"><label>Title:</label> <input type="text" id="bTitle"></div>
        <div style="margin-bottom:10px"><label>Author:</label> <input type="text" id="bAuthor"></div>
        <div style="margin-bottom:10px"><label>Theme:</label> <input type="text" id="bTheme"></div>
        <div style="margin-bottom:10px"><label>Level:</label> 
            <select id="bLevel">
                <option value="">Select</option>
                <option value="Beginner">Beginner</option>
                <option value="Intermediate">Intermediate</option>
                <option value="Advanced">Advanced</option>
            </select>
        </div>
        <button onclick="addBook()">Save Book</button>
    </div>

    <script>
        async function loadBooks() {
            let res = await fetch('/api/books');
            let books = await res.json();
            let html = '';
            books.forEach(b => {
                html += `<div class="book-item" onclick="window.location.href='book_details.html?id=${b.id}'">
                            <strong>${b.title}</strong> by ${b.author}
                         </div>`;
            });
            document.getElementById('bookList').innerHTML = html;
        }

        async function uploadAndVisualize() {
            let formData = new FormData();
            let fileInput = document.getElementById('fileInput');
            if(fileInput.files.length === 0) { alert("Select file first"); return; }
            formData.append('file', fileInput.files[0]);
            let response = await fetch('/api/upload', { method: 'POST', body: formData });
            let data = await response.json();
            drawGraph(data);
        }
        function drawGraph(data) {
            new vis.Network(document.getElementById('mynetwork'), 
                { nodes: new vis.DataSet(data.nodes), edges: new vis.DataSet(data.edges) }, 
                { nodes: { shape: 'dot', font: { color: 'white' } } }
            );
        }
        async function addBook() {
            let bookData = {
                id: document.getElementById('bId').value,
                title: document.getElementById('bTitle').value,
                author: document.getElementById('bAuthor').value,
                theme: document.getElementById('bTheme').value,
                level: document.getElementById('bLevel').value
            };
            if(!bookData.id) { alert("ID required"); return; }
            await fetch('/api/addBook', {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(bookData)
            });
            alert("Saved!");
            loadBooks();
        }
        
        loadBooks();
    </script>
</body>
</html>